# Chainalytic production deployment

## Steps to run Chainalytic via docker-compose

### Zone `public-icon`

#### 1. Choose a directory for storing Chainalytic data

This folder contains new data generated by Chainalytic

#### 2. In that directory, create a `docker-compose.yml` file, like below

[source]
----
version: '3'
services:
  chainalytic:
    image: duyyudus/chainalytic
    container_name: chainalytic
    restart: "always"
    network_mode: host
    volumes:
        - <PATH_ON_YOUR_HOST_TO_CITIZEN_NODE>/data/mainnet/.storage:/mainnet/.storage
        - <PATH_ON_YOUR_HOST_TO_CITIZEN_NODE>/data/mainnet/.score_data:/mainnet/.score_data
        - .chainalytic/cfg:/chainalytic/.chainalytic/cfg
        - .chainalytic/chainalytic_warehouse:/chainalytic/.chainalytic/chainalytic_warehouse
    ports:
        - 5530:5530
    command: --zone-id public-icon
----

#### 3. Create config files

[source]
----
.chainalytic/cfg/chain_registry.yml
.chainalytic/cfg/setting.yml
----

##### chain_registry.yml, need to edit

[source]
----
zones:
  - zone_id: 'public-icon'
    zone_name: 'Public ICON mainnet'

    # Citizen node endpoint, should be on the same localhost
    client_endpoint: 'localhost:9000'

    # Replace HOST_IP by the real value in ../data/mainnet/.storage... on your host
    chain_db_dir: '/mainnet/.storage/db_<HOST_IP>:7100_icon_dex'
    score_db_icondex_dir: '/mainnet/.score_data/db/icon_dex'

    # Set to 1 for fast rebuild data from the beginning
    # Set to 0 for realtime sync with citizen node
    direct_db_access: 1
----

##### setting.yml, default is good
[source]
----
upstream_endpoint: '0.0.0.0:5500'
aggregator_endpoint: '0.0.0.0:5510'
warehouse_endpoint: '0.0.0.0:5520'
provider_endpoint: '0.0.0.0:5530'

warehouse_dir: '.chainalytic/chainalytic_warehouse'

# E.g. ".chainalytic/chainalytic_warehouse/public-icon_storage"
zone_storage_dir: '{warehouse_dir}/{zone_id}_storage'

# E.g. ".chainalytic/chainalytic_warehouse/public-icon_storage/unstaking_storage"
transform_storage_dir: '{zone_storage_dir}/{transform_id}_storage'

transform_cache_dir: '{zone_storage_dir}/{transform_id}_cache'
----
